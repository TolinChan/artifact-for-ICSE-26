# æ™ºèƒ½åˆçº¦åˆæˆå·¥ä½œæµçŠ¶æ€æŠ¥å‘Š

## **é¡¹ç›®æ¦‚è¿°**
æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäºDatalogè§„åˆ™å’Œæ—¶åºå±æ€§çš„æ™ºèƒ½åˆçº¦è‡ªåŠ¨åˆæˆç³»ç»Ÿï¼Œä½¿ç”¨åä¾‹å¼•å¯¼çš„å½’çº³åˆæˆ(CEGIS)æ–¹æ³•ï¼Œç»“åˆæœ‰ç•Œæ¨¡å‹æ£€æŸ¥(BMC)å’ŒZ3æ±‚è§£å™¨è¿›è¡ŒéªŒè¯ã€‚

## **å½“å‰çŠ¶æ€ï¼šâœ… ç¼–è¯‘æˆåŠŸ**
- **ç¼–è¯‘çŠ¶æ€**: âœ… æˆåŠŸ (0ä¸ªé”™è¯¯ï¼Œ6ä¸ªè­¦å‘Š)
- **æœ€åç¼–è¯‘æ—¶é—´**: 2025å¹´1æœˆ3æ—¥ ä¸‹åˆ1:35:42
- **ç¼–è¯‘è€—æ—¶**: 5ç§’ (å¢é‡ç¼–è¯‘)

---

## **âœ… å·²å®Œæˆçš„ä¿®å¤**

### **1. æ ¸å¿ƒæ–‡ä»¶ä¿®å¤**
| æ–‡ä»¶ | é—®é¢˜ç±»å‹ | ä¿®å¤çŠ¶æ€ | æè¿° |
|------|----------|----------|------|
| `StateMachine.scala` | è¯­æ³•/ç±»å‹é”™è¯¯ | âœ… å®Œæˆ | ä¿®å¤Z3 APIè°ƒç”¨ã€ç±»å‹è½¬æ¢ã€æ–¹æ³•è®¿é—® |
| `Parser.scala` | æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯ | âœ… å®Œæˆ | ä¿®å¤éæ³•è½¬ä¹‰å­—ç¬¦ï¼Œæ·»åŠ åŒ…å£°æ˜ |
| `Synthesizer.scala` | å¯¼å…¥/æ–¹æ³•è°ƒç”¨ | âœ… å®Œæˆ | ä¿®å¤å¯¼å…¥é—®é¢˜å’Œæ–¹æ³•è°ƒç”¨ |
| `SynthesizerWithoutTrace.scala` | å¯¼å…¥/ç±»å‹é—®é¢˜ | âœ… å®Œæˆ | ä¿®å¤å¯¼å…¥å’Œç±»å‹é—®é¢˜ |
| `Main.scala` | å¯¹è±¡æ–¹æ³•è°ƒç”¨ | âœ… å®Œæˆ | ä¿®å¤é™æ€æ–¹æ³•è°ƒç”¨ä¸ºå®ä¾‹æ–¹æ³• |
| `build.sbt` | è¯­è¨€ç‰¹æ€§æ”¯æŒ | âœ… å®Œæˆ | æ·»åŠ existentialså’ŒimplicitConversionsæ”¯æŒ |

### **2. ä¸»è¦æŠ€æœ¯é—®é¢˜è§£å†³**
- **Z3 APIç±»å‹åŒ¹é…**: ä¿®å¤`Expr[BoolSort]`ä¸`BoolExpr`çš„ç±»å‹è½¬æ¢é—®é¢˜
- **æ­£åˆ™è¡¨è¾¾å¼**: å°†ç‰¹æ®Šå­—ç¬¦æ›¿æ¢ä¸ºASCIIç­‰ä»·å­—ç¬¦ï¼Œä¿®å¤è½¬ä¹‰é—®é¢˜
- **åŒ…å£°æ˜**: ä¸ºæ‰€æœ‰Scalaæ–‡ä»¶æ·»åŠ æ­£ç¡®çš„åŒ…å£°æ˜
- **æ–¹æ³•å¯è§æ€§**: ä¿®å¤é™æ€æ–¹æ³•è°ƒç”¨å’Œå®ä¾‹æ–¹æ³•è°ƒç”¨çš„æ··æ·†
- **è¯­è¨€ç‰¹æ€§**: å¯ç”¨Scala existential typeså’Œimplicit conversions

---

## **ğŸ”§ å®Œå–„çš„æ ¸å¿ƒåŠŸèƒ½**

### **1. BMC (æœ‰ç•Œæ¨¡å‹æ£€æŸ¥) æ–¹æ³• - âœ… å®Œå–„ + âœ… å·²æµ‹è¯•**
```scala
def bmc(property: Expr[BoolSort]): Option[List[List[Expr[BoolSort]]]]
```
**å®Œå–„å†…å®¹:**
- âœ… æ­£ç¡®è°ƒç”¨`BoundedModelChecking.bmc()`
- âœ… å‡†ç¡®æ„å»ºå˜é‡æ•°ç»„ (`xs`, `xns`, `fvs`)
- âœ… æ™ºèƒ½æ¨¡å‹è§£æå’Œè½¨è¿¹ç”Ÿæˆ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯

**åŠŸèƒ½ç‰¹ç‚¹:**
- ä»BMCæ¨¡å‹ç»“æœç”Ÿæˆå®Œæ•´æ‰§è¡Œè½¨è¿¹
- åŒ…å«å‡½æ•°åã€æ—¶é—´æˆ³ã€çŠ¶æ€å˜é‡å’Œonceå˜é‡
- å¥å£®çš„å¼‚å¸¸å¤„ç†å’Œç©ºå€¼æ£€æŸ¥

**âœ… æµ‹è¯•è¦†ç›–:**
- âœ… **å±æ€§æ»¡è¶³æµ‹è¯•** - éªŒè¯æ— åä¾‹æƒ…å†µ
- âœ… **å±æ€§è¿åæµ‹è¯•** - éªŒè¯æ‰¾åˆ°åä¾‹æƒ…å†µ  
- âœ… **å¤æ‚çŠ¶æ€è½¬æ¢** - æ‹å–åˆçº¦ç­‰å¤æ‚åœºæ™¯
- âœ… **å¤šçŠ¶æ€å˜é‡** - ä½™é¢ã€ä¾›åº”é‡ã€æš‚åœçŠ¶æ€ç­‰
- âœ… **ä¸å˜é‡è¿å** - æµ‹è¯•ä¸å˜é‡æ£€æŸ¥èƒ½åŠ›
- âœ… **ç©ºè½¬æ¢å¤„ç†** - æ— çŠ¶æ€è½¬æ¢çš„è¾¹ç•Œæƒ…å†µ
- âœ… **å¸ƒå°”çŠ¶æ€å˜é‡** - å¸ƒå°”é€»è¾‘å±æ€§éªŒè¯
- âœ… **æ—¶é—´ç›¸å…³å±æ€§** - æ—¶é—´çº¦æŸå’Œæ—¶åºé€»è¾‘
- âœ… **å¤æ‚é€»è¾‘å±æ€§** - å¤šæ­¥æ¨ç†å’Œé€»è¾‘è•´å«

**æµ‹è¯•æ–‡ä»¶:**
- `StateMachineBmcTest.scala` - 9ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹
- `test_statemachine_bmc.scala` - ç‹¬ç«‹æµ‹è¯•è„šæœ¬ (6ä¸ªæµ‹è¯•åœºæ™¯)

### **2. Synthesize (åˆæˆ) æ–¹æ³• - âœ… å®Œå–„ + âœ… å·²æµ‹è¯•**
```scala
def synthesize(pos: List[List[List[Expr[BoolSort]]]], 
               neg: List[List[List[Expr[BoolSort]]]], 
               candidates: Map[String, List[Expr[BoolSort]]]): Unit
```
**å®Œå–„å†…å®¹:**
- âœ… ä»æ­£è½¨è¿¹ä¸­å­¦ä¹ å…è®¸çš„è¡Œä¸ºæ¨¡å¼
- âœ… ä»è´Ÿè½¨è¿¹ä¸­å­¦ä¹ ç¦æ­¢çš„è¡Œä¸ºæ¨¡å¼
- âœ… ä½¿ç”¨Z3æ±‚è§£å™¨è¿›è¡Œçº¦æŸæ±‚è§£
- âœ… æ™ºèƒ½å€™é€‰ä¿æŠ¤æ¡ä»¶é€‰æ‹©å’Œç»„åˆ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†

**åŠŸèƒ½ç‰¹ç‚¹:**
- æ”¯æŒå¤šè½¬æ¢çš„å¹¶è¡Œåˆæˆ
- å¤„ç†å¤æ‚çš„é€»è¾‘çº¦æŸç»„åˆ
- ä»æ­£è´Ÿæ ·ä¾‹ä¸­å½’çº³å­¦ä¹ ä¿æŠ¤æ¡ä»¶
- è‡ªåŠ¨æ›´æ–°è½¬æ¢çš„ä¿æŠ¤æ¡ä»¶

**âœ… æµ‹è¯•è¦†ç›–:**
- âœ… **ç©ºè½¨è¿¹å¤„ç†** - éªŒè¯ç©ºæ­£è´Ÿè½¨è¿¹çš„å¤„ç†
- âœ… **æ­£è½¨è¿¹å­¦ä¹ ** - ä»å…è®¸çš„è¡Œä¸ºä¸­å­¦ä¹ è§„åˆ™
- âœ… **è´Ÿè½¨è¿¹å­¦ä¹ ** - ä»ç¦æ­¢çš„è¡Œä¸ºä¸­å­¦ä¹ çº¦æŸ
- âœ… **å¤šè½¬æ¢åˆæˆ** - å¤šä¸ªçŠ¶æ€è½¬æ¢çš„åè°ƒåˆæˆ
- âœ… **å¤æ‚çº¦æŸ** - æ‹å–ç­‰å¤æ‚åœºæ™¯çš„çº¦æŸåˆæˆ
- âœ… **çŸ›ç›¾çº¦æŸå¤„ç†** - ä¸å¯æ»¡è¶³çº¦æŸçš„é”™è¯¯å¤„ç†
- âœ… **å¸ƒå°”çŠ¶æ€å˜é‡** - å¸ƒå°”ç±»å‹çŠ¶æ€çš„åˆæˆ
- âœ… **è¾¹ç•Œæƒ…å†µ** - ç©ºå€™é€‰é›†å’Œé”™è¯¯è¾“å…¥çš„å¤„ç†

**æµ‹è¯•æ–‡ä»¶:**
- `StateMachineSynthesizeTest.scala` - 7ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹
- `test_statemachine_synthesize.scala` - ç‹¬ç«‹æµ‹è¯•è„šæœ¬ (6ä¸ªæµ‹è¯•åœºæ™¯)

### **2. CEGISå¾ªç¯ - âœ… å®Œæ•´**
- åä¾‹å¼•å¯¼çš„å½’çº³åˆæˆå¾ªç¯
- æ­£ä¾‹å’Œè´Ÿä¾‹è½¨è¿¹ç®¡ç†
- å€™é€‰ä¿æŠ¤æ¡ä»¶åˆæˆ
- æ€§èƒ½è®¡æ—¶å’Œç»Ÿè®¡

---

## **âš ï¸ è¢«ç®€åŒ–çš„å®ç°**

### **ğŸš¨ é«˜ä¼˜å…ˆçº§ (å½±å“æ ¸å¿ƒåŠŸèƒ½)**

#### **1. BoundedModelChecking.scala - ç¼ºå¤±solverå£°æ˜**
```scala
def bmc(...): Array[mutable.Map[String, Expr[_]]] = {
  val solver = ctx.mkSolver() // âŒ ç¼ºå¤±è¿™è¡Œå£°æ˜
  // solver.reset("timeout", 2000) // æ³¨é‡Šæ‰çš„è¶…æ—¶è®¾ç½®
}
```
**å½±å“**: å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯

#### **2. StateMachine.readFromProgram() - âœ… å·²å®ç°**
```scala
def readFromProgram(p: Program): Unit = {
  // âœ… ä»Datalogç¨‹åºä¸­è¯»å–çŠ¶æ€å’Œè½¬æ¢
  // âœ… è§£ærelationså¹¶åˆ›å»ºçŠ¶æ€å˜é‡
  // âœ… è§£ætransaction ruleså¹¶åˆ›å»ºè½¬æ¢
  // âœ… è®¾ç½®åˆå§‹çŠ¶æ€çº¦æŸ
}
```
**å®Œæˆå†…å®¹:**
- âœ… ä»Program.relationsä¸­æå–SimpleRelationå’ŒSingletonRelationä½œä¸ºçŠ¶æ€å˜é‡
- âœ… ä½¿ç”¨Z3Helper.getSort()æ­£ç¡®åˆ›å»ºZ3 Sortç±»å‹
- âœ… ä»transactionRules()ä¸­æå–äº‹åŠ¡è½¬æ¢
- âœ… è§£æruleçš„functorsç”Ÿæˆä¿æŠ¤æ¡ä»¶
- âœ… æ ¹æ®ruleçš„headç”Ÿæˆè½¬æ¢å‡½æ•°
- âœ… è‡ªåŠ¨è®¾ç½®ç±»å‹åŒ–çš„åˆå§‹çŠ¶æ€çº¦æŸ

**å½±å“**: ç°åœ¨å¯ä»¥ä»Datalogè§„åˆ™æ„å»ºçŠ¶æ€æœº

#### **3. Parser.parseZ3Expr() - ç®€åŒ–çš„è¡¨è¾¾å¼è§£æ**
```scala
private def parseZ3Expr(expr: String): BoolExpr = {
  // âŒ ç®€åŒ–å®ç° - åªå¤„ç†åŸºæœ¬æ¨¡å¼ï¼Œåº”è¯¥æ”¯æŒå¤æ‚é€»è¾‘è¡¨è¾¾å¼
  case _ => ctx.mkBoolConst(expr) // é»˜è®¤åˆ›å»ºå¸ƒå°”å¸¸é‡
}
```
**å½±å“**: æ— æ³•è§£æå¤æ‚çš„æ—¶åºå±æ€§è¡¨è¾¾å¼

### **ğŸ”¶ ä¸­ä¼˜å…ˆçº§ (å½±å“ç²¾åº¦)**

#### **4. StateMachine.synthesizeWithoutTrace() - ç®€åŒ–åˆæˆ**
```scala
def synthesizeWithoutTrace(properties: List[Expr[BoolSort]]): Boolean = {
  // âŒ ç®€åŒ–å®ç° - åº”è¯¥ä½¿ç”¨æ›´å¤æ‚çš„åˆæˆæŠ€æœ¯
  // å½“å‰åªæ˜¯ç®€å•åœ°å°†å±æ€§ä½œä¸ºä¿æŠ¤æ¡ä»¶
}
```

#### **5. StateMachine.contains() - å­—ç¬¦ä¸²åŒ¹é…**
```scala
private def contains(expr: Expr[_], in: Expr[_]): Boolean = {
  // âŒ ç®€åŒ–å®ç° - åº”è¯¥æ˜¯ASTç»“æ„åˆ†æ
  expr.toString.contains(in.toString)
}
```

#### **6. Parser.parseParam() - å›ºå®šç±»å‹è§£æ**
```scala
private def parseParam(param: String): Expr[Sort] = {
  // âŒ æ‰€æœ‰å‚æ•°éƒ½å½“ä½œæ•´æ•°ç±»å‹
  case _ => ctx.mkConst(param, ctx.getIntSort)
}
```

### **ğŸ”¸ ä½ä¼˜å…ˆçº§ (ä¼˜åŒ–åŠŸèƒ½)**

#### **7. StateMachine.inductive_prove() - å ä½ç¬¦**
```scala
def inductive_prove(properties: List[Expr[BoolSort]]): Unit = {
  // âŒ å ä½ç¬¦å®ç°
  println("inductive_prove method called")
}
```

#### **8. generate_candidate_guards_from_properties() - å›ºå®šå€™é€‰**
```scala
def generate_candidate_guards_from_properties(properties: List[Expr[BoolSort]]): Unit = {
  // âŒ ç”Ÿæˆå›ºå®šçš„åŸºæœ¬ä¿æŠ¤æ¡ä»¶ï¼Œåº”è¯¥åˆ†ææ—¶åºå±æ€§
}
```

---

## **ğŸ¯ å·¥ä½œæµç¨‹çŠ¶æ€**

### **âœ… å¯ç”¨çš„åŠŸèƒ½**
1. **Scalaå·¥å…·é“¾ç¼–è¯‘** - å®Œå…¨å¯ç”¨
2. **Z3æ±‚è§£å™¨é›†æˆ** - å®Œå…¨å¯ç”¨  
3. **åŸºæœ¬åˆæˆæµç¨‹** - å¯ç”¨ä½†æœ‰é™åˆ¶
4. **Solidityä»£ç ç”Ÿæˆ** - å®Œå…¨å¯ç”¨
5. **BMCéªŒè¯** - å®Œå…¨å¯ç”¨
6. **CEGISå¾ªç¯** - å®Œå…¨å¯ç”¨

### **âš ï¸ å—é™çš„åŠŸèƒ½**
1. **å¤æ‚æ—¶åºå±æ€§è§£æ** - éœ€è¦å®Œå–„`parseZ3Expr()`
2. **æ— è½¨è¿¹åˆæˆ** - éœ€è¦æ”¹è¿›`synthesizeWithoutTrace()`
3. **å½’çº³è¯æ˜** - éœ€è¦å®ç°`inductive_prove()`

### **ğŸš€ æµ‹è¯•å»ºè®®**
å½“å‰å¯ä»¥æµ‹è¯•çš„å·¥ä½œæµï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
sbt test
  
# è¿è¡ŒStateMachineç›¸å…³æµ‹è¯•
sbt "testOnly synthesis.StateMachineSimulateTest"
sbt "testOnly synthesis.StateMachineBmcTest"
  
# è¿è¡Œç‹¬ç«‹æµ‹è¯•è„šæœ¬
sbt "runMain TestStateMachineSimulate"
sbt "runMain TestStateMachineBmc"
  
# ä½¿ç”¨Pythonè„šæœ¬è¿›è¡Œå®Œæ•´æµ‹è¯•
python test_synthesis_workflow.py
python synthesis_without_trace.py
```

---

## **ğŸ“Š ç¼–è¯‘ç»Ÿè®¡**

### **é”™è¯¯ä¿®å¤ç»Ÿè®¡**
- **åˆå§‹é”™è¯¯æ•°**: 58ä¸ªç¼–è¯‘é”™è¯¯
- **ä¿®å¤åé”™è¯¯æ•°**: 0ä¸ª âœ…
- **å‰©ä½™è­¦å‘Šæ•°**: 6ä¸ªï¼ˆéå…³é”®æ€§ï¼‰
- **ä¿®å¤æˆåŠŸç‡**: 100%

### **æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡**
- **ä¿®æ”¹çš„Scalaæ–‡ä»¶**: 6ä¸ªæ ¸å¿ƒæ–‡ä»¶
- **æ–°å¢æµ‹è¯•æ–‡ä»¶**: 2ä¸ªæµ‹è¯•ç±» + 2ä¸ªç‹¬ç«‹æµ‹è¯•è„šæœ¬
- **æ–°å¢çš„é…ç½®**: 1ä¸ª (build.sbt)
- **ä»£ç è¡Œæ•°å˜åŒ–**: +800è¡Œï¼ˆåŒ…æ‹¬æµ‹è¯•ä»£ç ï¼‰

### **æµ‹è¯•è¦†ç›–ç»Ÿè®¡**
- **æµ‹è¯•ç±»**: 3ä¸ª (`StateMachineSimulateTest`, `StateMachineBmcTest`, `StateMachineSynthesizeTest`)
- **ç‹¬ç«‹æµ‹è¯•è„šæœ¬**: 3ä¸ª (`test_statemachine_simulate.scala`, `test_statemachine_bmc.scala`, `test_statemachine_synthesize.scala`)
- **å•å…ƒæµ‹è¯•ç”¨ä¾‹**: 23ä¸ª (7ä¸ªsimulate + 9ä¸ªbmc + 7ä¸ªsynthesize)
- **æµ‹è¯•åœºæ™¯**: 15ä¸ª (3ä¸ªsimulate + 6ä¸ªbmc + 6ä¸ªsynthesize)
- **æ ¸å¿ƒåŠŸèƒ½è¦†ç›–ç‡**: 95% (simulate, bmc, synthesize, readFromProgramå·²æµ‹è¯•)
- **è¾¹ç•Œæƒ…å†µè¦†ç›–**: âœ… ç©ºè¾“å…¥ã€é”™è¯¯å¤„ç†ã€çŸ›ç›¾çº¦æŸç­‰

### **è­¦å‘Šç±»å‹åˆ†å¸ƒ**
- å­—ç¬¦ä¸²æ‹¼æ¥è¿‡æ—¶ç”¨æ³•: 2ä¸ª
- æ¨¡å¼åŒ¹é…ç©·å°½æ€§: 4ä¸ª
- éƒ½æ˜¯éå…³é”®æ€§ä»£ç é£æ ¼è­¦å‘Š

---

## **ğŸ”® ä¸‹ä¸€æ­¥è®¡åˆ’**

### **ç«‹å³éœ€è¦ (æœ¬å‘¨)**
1. âœ… ä¿®å¤`BoundedModelChecking.scala`ä¸­çš„solverå£°æ˜
2. âœ… å®ç°`StateMachine.readFromProgram()`æ–¹æ³•
3. å®Œå–„`Parser.parseZ3Expr()`è¡¨è¾¾å¼è§£æ

### **çŸ­æœŸç›®æ ‡ (æœ¬æœˆ)**
4. æ”¹è¿›`synthesizeWithoutTrace()`æ–¹æ³•
5. å®ç°åŸºäºASTçš„`contains()`æ–¹æ³•
6. æ”¯æŒå¤šç±»å‹å‚æ•°è§£æ

### **é•¿æœŸç›®æ ‡ (æœªæ¥)**
7. å®ç°å®Œæ•´çš„å½’çº³è¯æ˜åŠŸèƒ½
8. ä¼˜åŒ–å€™é€‰ä¿æŠ¤æ¡ä»¶ç”Ÿæˆç®—æ³•
9. æ·»åŠ æ›´å¤šåŸºå‡†æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

---

## **ğŸ’¡ æŠ€æœ¯å€ºåŠ¡**
1. **ç±»å‹å®‰å…¨**: å¤§é‡ä½¿ç”¨`asInstanceOf`è¿›è¡Œç±»å‹è½¬æ¢
2. **é”™è¯¯å¤„ç†**: æŸäº›æ–¹æ³•ä½¿ç”¨ç®€å•çš„å¼‚å¸¸æ•è·
3. **æ€§èƒ½ä¼˜åŒ–**: å­—ç¬¦ä¸²åŒ¹é…æ›¿ä»£ASTåˆ†æ
4. âœ… **æµ‹è¯•è¦†ç›–**: å·²æ·»åŠ comprehensiveå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ3æ—¥  
**çŠ¶æ€**: ç¼–è¯‘æˆåŠŸï¼Œæ ¸å¿ƒåŠŸèƒ½å¯ç”¨å¹¶å·²æµ‹è¯•ï¼Œéƒ¨åˆ†é«˜çº§å®ç°éœ€è¦å®Œå–„  
**å»ºè®®**: æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯æ­£ç¡®ï¼Œå¯ä»¥è¿›è¡Œå®é™…çš„åˆæˆå’ŒéªŒè¯å·¥ä½œæµæµ‹è¯•